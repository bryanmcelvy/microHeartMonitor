<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uHeartMonitor: An ECG-based Heart Rate Monitor: Materials &amp; Methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">uHeartMonitor: An ECG-based Heart Rate Monitor
   </div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('page_meth.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Materials &amp; Methods</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_meth_hard">Hardware Design</a><ul><ul><li class="level3"><a href="#sec_meth_afe">Analog-Front End</a></li>
<li class="level3"><a href="#sec_meth_iso">Optical Isolation Circuitry</a></li>
<li class="level3"><a href="#sec_meth_mcu">Microcontroller Circuit</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#sec_meth_soft">Software Architecture</a><ul><ul><li class="level3"><a href="#sec_meth_device">Device Drivers</a></li>
<li class="level3"><a href="#sec_meth_mid">Middleware</a></li>
<li class="level3"><a href="#sec_meth_app">Application Software</a></li>
<li class="level3"><a href="#sec_meth_ext">External</a></li>
<li class="level3"><a href="#sec_meth_com">Common</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#page_build">Build Instructions</a><ul><li class="level2"><a href="#sec_build_hw">Hardware</a></li>
<li class="level2"><a href="#sec_build_sw">Software</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sec_meth_hard"></a>
Hardware Design</h1>
<p> 
<details>
<summary> ❗️ Click to see overall circuit schematic ❗️ </summary>
<img src="../../figures/schematics/circuit_overall.png" width="750" />
</details>
</p>
<p></p>
<p>The hardware is divided into three modules: the analog-front end (AFE), the optical isolation circuit, and the microcontroller/display circuit.</p>
<h3><a class="anchor" id="sec_meth_afe"></a>
Analog-Front End</h3>
<p> 
<details>
<summary> ❗️ Click to see analog-front end circuit schematic❗️</summary>
<img src="../../figures/schematics/circuit_afe.png" width="750" />
</details>
</p>
<p></p>
<p>The AFE consists of an instrumentation amplifier with a gain of <img class="formulaInl" alt="$100$" src="form_5.png" width="19" height="9"/>; a 2nd-order Sallen-Key high-pass filter with a gain of <img class="formulaInl" alt="$1$" src="form_6.png" width="5" height="9"/> and a cutoff frequency of ~ <img class="formulaInl" alt="$0.5$" src="form_7.png" width="16" height="9"/> <img class="formulaInl" alt="$Hz$" src="form_8.png" width="18" height="10"/>; and a 2nd-order Sallen-Key low-pass filter with a passband gain of <img class="formulaInl" alt="$11$" src="form_9.png" width="11" height="9"/> and a cutoff frequency of ~ <img class="formulaInl" alt="$40$" src="form_10.png" width="14" height="9"/> <img class="formulaInl" alt="$Hz$" src="form_8.png" width="18" height="10"/>. The overall gain is <img class="formulaInl" alt="$1100$" src="form_11.png" width="25" height="9"/></p>
<h3><a class="anchor" id="sec_meth_iso"></a>
Optical Isolation Circuitry</h3>
<p> 
<details>
<summary> ❗️ Click to see optical isolation circuit schematic❗️ </summary>
<img src="../../figures/schematics/circuit_isolation.png" width="750" />
</details>
</p>
<p></p>
<p>The optical isolation circuit uses a linear optocoupler to transmit the ECG signal from the analog-front end circuit to the microcontroller circuit. This circuitry serves as a safety measure against power surges and other potential hazards that can occur as a result of connecting someone directly to mains power (for example, death).</p>
<p>It also has three resistors on the AFE-side that effectively shift the signal from the projected output range of ± <img class="formulaInl" alt="$5.5$" src="form_12.png" width="15" height="9"/> <img class="formulaInl" alt="$V$" src="form_13.png" width="10" height="10"/> to the range <img class="formulaInl" alt="$[0, 3.5)$" src="form_14.png" width="35" height="14"/> <img class="formulaInl" alt="$V$" src="form_13.png" width="10" height="10"/>, which is necessary for both the optocoupler and the microcontroller's built-in analog-to-digital converter (ADC) circuitry.</p>
<h3><a class="anchor" id="sec_meth_mcu"></a>
Microcontroller Circuit</h3>
<p> 
<details>
<summary> ❗️ Click to see microcontroller circuit schematic❗️ </summary>
<img src="../../figures/schematics/circuit_mcu.png" width="750" />
</details>
</p>
<p></p>
<p>The microcontroller circuit currently consists of a TM4C123 microcontroller mounted on a LaunchPad evaluation kit, and an MSP2807 liquid crystal display (LCD).</p>
<h1><a class="anchor" id="sec_meth_soft"></a>
Software Architecture</h1>
<p>The software has a total of 14 modules, 11 of which are (somewhat loosely) divided into three layers: application-specific software, middleware, and device drivers. The call graph and data flow graph visually represent the software architecture.</p>
<p> 
<details>
<summary> ❗️ Click to see call graph ❗️ </summary>
<img src="../../figures/software/call.png" width="500" />
</p>
<p></p>
<p>This graph shows which modules communicate with (or "call") each other. Each arrow points from the "caller" to the "callee".</p>
<p>It also somewhat doubles as an <code>#include</code> dependency graph.</p>
<p> 
</details>

<details>
<summary> ❗️ Click to see data flow graph ❗️ </summary>
<img src="../../figures/software/data_flow.png" width="750" />
</p>
<p></p>
<p>This graph shows the flow of information from the patient to the LCD (and also the laptop).</p>
<p> 
</details>
</p>
<h3><a class="anchor" id="sec_meth_device"></a>
Device Drivers</h3>
<p>The device driver layer consists of software modules that interface directly with the microcontroller's built-in peripheral devices. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__driver.html">Device Drivers</a></dd></dl>
<h3><a class="anchor" id="sec_meth_mid"></a>
Middleware</h3>
<p>The middleware layer consists of higher-level device drivers that interface with some hardware connected to one of the built-in peripherals (i.e. the Debug module connects to UART and the ILI9341 module primarily uses SPI). </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__middleware.html">Middleware</a></dd></dl>
<h3><a class="anchor" id="sec_meth_app"></a>
Application Software</h3>
<p>The application software layer has modules that are at least partially, if not completely built for this project. This layer includes the data acquisition module, whose functions handle receiving raw input samples and denoising them; the QRS detector, which analyzes the filtered signal to determine the average heart rate; and the LCD module, which plots the ECG waveform and displays the heart rate. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__app.html">Application Software</a></dd></dl>
<h3><a class="anchor" id="sec_meth_ext"></a>
External</h3>
<p>This "layer" includes modules/libraries/files that were not written (or at least heavily altered) by me. It currently only contains portions of ARM's CMSIS-Core and CMSIS-DSP libraries.</p>
<h3><a class="anchor" id="sec_meth_com"></a>
Common</h3>
<p>The "common" modules are general-purpose modules that don't necessarily fit into the above categories/layers. This category includes the "Fifo" module, which contains a ring buffer-based implementation of the FIFO buffer (AKA "queue") data structure; and "NewAssert", which is essentially just an implementation of the <code>assert</code> macro that causes a breakpoint (and also doesn't use up as much RAM as the standard implementation does). </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__common.html">Common</a></dd></dl>
<h1><a class="anchor" id="page_build"></a>
Build Instructions</h1>
<h2><a class="anchor" id="sec_build_hw"></a>
Hardware</h2>
<p>WIP</p>
<h2><a class="anchor" id="sec_build_sw"></a>
Software</h2>
<p>WIP </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
